<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة الإدارة - نور الحوزة</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Cairo',sans-serif;background:#f7f7f7;color:#333;padding:2rem;text-align:center;}
    form{background:#fff;padding:2rem;border-radius:8px;display:inline-block;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
    label{display:block;margin-bottom:.5rem;font-weight:600;}
    input{padding:.5rem .8rem;width:100%;margin-bottom:1rem;border:1px solid #ccc;border-radius:4px;}
    button{padding:.5rem 1rem;background:#054a29;color:#fff;border:none;border-radius:4px;cursor:pointer;}
    button:hover{background:#0a6b3e;}
    #questions{margin-top:2rem;text-align:right;max-width:700px;margin-inline:auto;}
    #questions .q-item{background:#fff;margin-bottom:1rem;padding:1rem;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
    #questions textarea{width:100%;margin-top:.5rem;margin-bottom:.5rem;padding:.5rem;border:1px solid #ccc;border-radius:4px;}
  </style>
</head>
<body>
  <form id="loginForm">
    <label for="password">كلمة المرور:</label>
    <input type="password" id="password" required>
    <button type="submit">دخول</button>
  </form>
  <div id="questions" hidden></div>
<script>
const form=document.getElementById('loginForm');
const container=document.getElementById('questions');
form.addEventListener('submit',async e=>{
  e.preventDefault();
  const password=document.getElementById('password').value;
  const res=await fetch('/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password})});
  if(res.ok){
    form.style.display='none';
    container.hidden=false;
    loadQuestions();
  }else{alert('كلمة المرور غير صحيحة');}
});
async function loadQuestions(){
  const res=await fetch('/admin/questions');
  if(!res.ok)return alert('فشل جلب الأسئلة');
  const data=await res.json();
  container.innerHTML='';
  data.forEach((q,idx)=>{
    const wrapper=document.createElement('div');
    wrapper.className='q-item';
    const qText=document.createElement('p');
    qText.textContent=`${q.date.slice(0,10)}: ${q.question}`;
    wrapper.appendChild(qText);
    const textarea=document.createElement('textarea');
    textarea.rows=3;
    textarea.value=q.answer||'';
    wrapper.appendChild(textarea);
    const btn=document.createElement('button');
    btn.textContent='حفظ الإجابة';
    btn.addEventListener('click',async()=>{
      const answer=textarea.value.trim();
      const save=await fetch('/admin/answer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({index:idx,answer})});
      if(save.ok){alert('تم الحفظ');loadQuestions();}
      else alert('فشل الحفظ');
    });
    wrapper.appendChild(btn);
    container.appendChild(wrapper);
  });
}
</script>
</body>
</html>
