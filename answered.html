<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الأسئلة المجابة | نور الحوزة</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="icon" href="Icon.png" type="image/png">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f7f7f7;
      color: #333;
      line-height: 1.8;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 90%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 1rem;
    }
    header {
      background: #054a29;
      color: #fff;
      padding: 1rem 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    nav ul {
      list-style: none;
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin: 0;
      padding: 0;
    }
    nav a {
      color: #f9e9b6;
      text-decoration: none;
      font-weight: 500;
      font-size: 1.1rem;
      transition: color 0.3s ease;
    }
    nav a:hover, nav a.active {
      color: #fff;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
    }
    h1 {
      text-align: center;
      margin: 2.5rem 0;
      color: #054a29;
      font-weight: 700;
    }
    ul.answers {
      list-style: none;
      padding: 0;
    }
    ul.answers li {
      background-color: #fff;
      margin-bottom: 1.2rem;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      line-height: 1.7;
      border-right: 5px solid #054a29;
    }
    ul.answers li strong {
      color: #b35f2f;
      font-weight: 700;
    }
    .answer {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px dashed #e0e0e0;
      color: #333;
      font-weight: 400;
    }
    .answer .answer-title {
      color: #054a29;
      font-weight: 600;
    }
    .model-intro {
        font-size: 1.1rem;
        font-weight: 600;
        color: #b35f2f;
    }
    .model-description {
        margin-top: 0.5rem;
        margin-bottom: 1rem;
    }
    .model-link {
        display: inline-block;
        background-color: #054a29;
        color: #f9e9b6;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 600;
        transition: background-color 0.3s ease;
    }
    .model-link:hover {
        background-color: #b35f2f;
        color: #fff;
    }
    .important-notice {
        background-color: #fffbe6;
        border: 1px solid #ffe58f;
        border-right-width: 5px;
        border-right-color: #f59e0b;
        padding: 1.5rem;
        margin-top: 2rem;
        border-radius: 8px;
        color: #92400e;
    }
    .important-notice h3 {
        margin-top: 0;
        color: #b45309;
        font-size: 1.3rem;
    }
    .error-message {
        background-color: #fbe9e9;
        color: #c0392b;
        border: 1px solid #f5b7b1;
        border-right-width: 5px;
        border-right-color: #c0392b;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-radius: 8px;
        text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav-container">
      <nav class="main-navigation" aria-label="القائمة الرئيسية">
        <ul>
          <li><a href="index.html" class="nav-link"><i class="fas fa-home"></i> الرئيسية</a></li>
          <li><a href="about.html" class="nav-link"><i class="fas fa-users"></i> مَنْ نحن</a></li>
          <li><a href="masadir.html" class="nav-link"><i class="fas fa-book-open"></i> مصادرنا</a></li>
          <li><a href="faq.html" class="nav-link"><i class="fas fa-circle-question"></i> الأسئلة الشائعة</a></li>
          <li><a href="answered.html" class="nav-link active"><i class="fas fa-comments"></i> الأسئلة المجابة</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <main class="container">
    <h1><i class="fas fa-comments"></i> الأسئلة المجابة ونماذجنا الجديدة</h1>
    <ul class="answers" id="answerList">
        <li style="text-align: center; padding: 2rem; border-right-color: #ccc;">جاري تحميل الأرشيف، يرجى الانتظار...</li>
    </ul>
    
    <div class="important-notice">
        <h3><i class="fas fa-exclamation-triangle"></i> تنبيه مهم حول النماذج التجريبية</h3>
        <p>يرجى العلم بأن النماذج الثلاثة الجديدة (*نور الخطابة، نور القرآن، ونور المهدي*) لا تزال في المرحلة التجريبية، وتحتاج إلى المزيد من التطوير والصقل. قد لا تكون دقتها حاليًا بنفس مستوى النموذج الأم "نور الحوزة". استخدامكم وملاحظاتكم ستكون خير معين لنا في تطويرها، فلكم منا جزيل الشكر.</p>
    </div>
  </main>
  
  <script>
    const newNoorModels = [
      {
        isModel: true,
        icon: '🎤',
        title: 'نور الخطابة',
        description: 'لخدمة الخطباء والمبلّغين في إعداد المحاضرات والمجالس الحسينية، وتقديم الشعر الحسيني الأصيل والمعاصر، وكل ما يتعلق بفن الخطابة المنبرية.',
        link: 'https://chatgpt.com/g/g-68671d2b8ff08191baea198580e2747a-nwr-lkhtb-tb-lnwr-lhwz'
      },
      {
        isModel: true,
        icon: '📖',
        title: 'نور القرآن',
        description: 'مساعدكم المتخصص في تدبّر آيات الذكر الحكيم وفهم معانيها، بالاعتماد على مدرسة أهل البيت (عليهم السلام) في التفسير، وربط الآيات بروايات العترة الطاهرة.',
        link: 'https://chatgpt.com/g/g-68691f3f9f0481919c239cac0c600889-nwr-lqrn-tb-lnwr-lhwz'
      },
      {
        isModel: true,
        icon: '🕊️',
        title: 'نور المهدي (عج)',
        description: 'نافذتكم لتعميق المعرفة بالقضية المهدوية، والبحث في شؤون الإمام المنتظر (عجل الله فرجه الشريف)، وعلامات الظهور، وواجبات المؤمنين في زمن الغيبة.',
        link: 'https://chatgpt.com/g/g-68692935aaa881918dd24264162517a9-nwr-lmhdy-lyh-lslm-tb-lnwr-lhwz'
      }
    ];

    function renderListItem(listElement, item) {
      const li = document.createElement('li');
      if (item.isModel) {
        li.innerHTML = `
          <p class="model-intro">${item.icon} ${item.title}:</p>
          <p class="model-description">${item.description}</p>
          <a href="${item.link}" target="_blank" class="model-link" rel="noopener noreferrer">
            <i class="fas fa-external-link-alt"></i> افتح النموذج
          </a>
        `;
      } else {
        const date = document.createElement('strong');
        date.textContent = new Date(item.answeredDate || item.date).toLocaleDateString('ar-EG-u-nu-latn', { year: 'numeric', month: 'long', day: 'numeric' }) + ': ';
        
        const questionText = document.createElement('strong');
        questionText.textContent = "السؤال: ";
        li.appendChild(questionText);
        li.append(item.question);

        const ans = document.createElement('div');
        ans.className = 'answer';
        ans.innerHTML = `<span class="answer-title">الجواب:</span> ${item.answer}`;
        li.appendChild(ans);
      }
      listElement.appendChild(li);
    }
    
    function renderError(listElement, message) {
        listElement.innerHTML = '';
        const errorLi = document.createElement('li');
        errorLi.className = 'error-message';
        errorLi.innerHTML = `
            <i class="fas fa-exclamation-circle"></i> <strong>خطأ في الاتصال</strong>
            <p>${message}</p>
        `;
        listElement.appendChild(errorLi);
    }

    async function loadAnsweredAndModels() {
      const list = document.getElementById('answerList');
      if (!list) return;

      try {
        const res = await fetch('/.netlify/functions/api/answered');
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          throw new Error(errorData.error || `فشل في جلب الأسئلة المجابة من الخادم (رمز الحالة: ${res.status}). يرجى المحاولة لاحقاً.`);
        }
        const fetchedQuestions = await res.json();
        
        list.innerHTML = '';
        newNoorModels.forEach(model => renderListItem(list, model));
        
        if (fetchedQuestions.length > 0) {
            fetchedQuestions.forEach(q => renderListItem(list, q));
        } else {
            const noQuestionsLi = document.createElement('li');
            noQuestionsLi.style.textAlign = 'center';
            noQuestionsLi.style.padding = '2rem';
            noQuestionsLi.style.borderRightColor = '#ccc';
            noQuestionsLi.textContent = 'لا توجد أسئلة مجابة في الأرشيف حاليًا.';
            list.appendChild(noQuestionsLi);
        }

      } catch (error) {
        console.error('حدث خطأ أثناء الاتصال بالخادم:', error);
        renderError(list, 'عفواً، تعذر تحميل الأرشيف في الوقت الحالي بسبب مشكلة تقنية. نعمل على إصلاحها.');
      }
    }

    loadAnsweredAndModels();
  </script>
<script>if("serviceWorker" in navigator){navigator.serviceWorker.register("/sw.js");}</script>
</body>
</html>
